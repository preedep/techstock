<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>TechStock - Resource Management</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/css/enterprise-theme.css?v=1.0.0">
    <link rel="stylesheet" href="/css/searchable-dropdown.css?v=1.0.0">
    <link rel="stylesheet" href="/css/tags-component.css?v=1.0.0">
    <link rel="stylesheet" href="/css/styles.css?v=1.0.0">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1><i class="fas fa-server"></i> TechStock</h1>
                <p>Azure Resource Management System</p>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="resources">
                <i class="fas fa-cube"></i> Resources
            </button>
            <button class="tab-btn" data-tab="dashboard">
                <i class="fas fa-chart-pie"></i> Dashboard
            </button>
            <button class="tab-btn" data-tab="subscriptions">
                <i class="fas fa-credit-card"></i> Subscriptions
            </button>
        </nav>

        <!-- Resources Tab -->
        <div id="resources-tab" class="tab-content active">
            <!-- Search and Filter Section -->
            <div class="search-filters">
                <div class="search-row">
                    <div class="search-group">
                        <label>ค้นหา:</label>
                        <input type="text" id="search-input" placeholder="ค้นหาชื่อ resource...">
                    </div>
                    <div class="search-group">
                        <label>Type:</label>
                        <select id="type-filter">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label>Location:</label>
                        <select id="location-filter">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label>Environment:</label>
                        <select id="environment-filter">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label>Vendor:</label>
                        <select id="vendor-filter">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label><i class="fas fa-credit-card"></i> Subscription:</label>
                        <select id="subscription-filter">
                            <option value="">ทั้งหมด</option>
                        </select>
                    </div>
                    <div class="search-group">
                        <label><i class="fas fa-folder"></i> Resource Group:</label>
                        <div id="resource-group-dropdown-container"></div>
                        <small class="text-muted">เลือก Subscription ก่อนเพื่อดู Resource Groups</small>
                    </div>
                </div>
                <div class="search-row">
                    <div class="search-group tags-search-group">
                        <label>Tags:</label>
                        <div id="tags-dropdown-container"></div>
                        <small>เลือกจาก dropdown หรือเพิ่ม tags ใหม่</small>
                    </div>
                </div>
                <div class="search-actions">
                    <button id="search-btn" class="btn btn-primary">
                        <i class="fas fa-search"></i> ค้นหา
                    </button>
                    <button id="clear-btn" class="btn btn-secondary">
                        <i class="fas fa-eraser"></i> ล้างตัวกรอง
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-header">
                    <h2 class="results-title">
                        <i class="fas fa-database"></i> Resources
                    </h2>
                    <div class="results-count">
                        <span id="resource-count">0 รายการ</span>
                    </div>
                    <div class="action-buttons-header">
                        <button id="add-resource-btn" class="btn btn-success">
                            <i class="fas fa-plus"></i> เพิ่ม Resource
                        </button>
                        <button id="column-toggle-btn" class="btn btn-info">
                            <i class="fas fa-columns"></i> จัดการคอลัมน์
                        </button>
                    </div>
                </div>

            <!-- Column Toggle Panel -->
            <div id="column-panel" class="column-panel" style="display: none;">
                <h4>เลือกคอลัมน์ที่ต้องการแสดง:</h4>
                <div class="column-checkboxes">
                    <label><input type="checkbox" data-column="id" checked> ID</label>
                    <label><input type="checkbox" data-column="name" checked> Name</label>
                    <label><input type="checkbox" data-column="type" checked> Type</label>
                    <label><input type="checkbox" data-column="location" checked> Location</label>
                    <label><input type="checkbox" data-column="subscription" checked> Subscription</label>
                    <label><input type="checkbox" data-column="resource-group" checked> Resource Group</label>
                    <label><input type="checkbox" data-column="environment" checked> Environment</label>
                    <label><input type="checkbox" data-column="vendor" checked> Vendor</label>
                    <label><input type="checkbox" data-column="tags" checked> Tags</label>
                    <label><input type="checkbox" data-column="created" checked> Created</label>
                    <label><input type="checkbox" data-column="actions" checked> Actions</label>
                </div>
            </div>

                <!-- Resources Table -->
                <div class="table-container">
                    <div class="table-responsive">
                        <table id="resources-table" class="table">
                    <thead>
                        <tr>
                            <th data-sort="id" class="sortable">
                                ID <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="name" class="sortable">
                                Name <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="resource_type" class="sortable">
                                Type <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="location" class="sortable">
                                Location <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="subscription_id" class="sortable">
                                Subscription <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="resource_group_id" class="sortable">
                                Resource Group <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="environment" class="sortable">
                                Environment <i class="fas fa-sort"></i>
                            </th>
                            <th data-sort="vendor" class="sortable">
                                Vendor <i class="fas fa-sort"></i>
                            </th>
                            <th>Tags</th>
                            <th data-sort="created_at" class="sortable">
                                Created <i class="fas fa-sort"></i>
                            </th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="resources-tbody">
                        <!-- Data will be loaded here -->
                    </tbody>
                    </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                <div class="pagination-controls">
                    <button id="prev-page" class="btn btn-secondary" disabled>
                        <i class="fas fa-chevron-left"></i> ก่อนหน้า
                    </button>
                    <span id="page-info">หน้า 1 จาก 1</span>
                    <button id="next-page" class="btn btn-secondary" disabled>
                        ถัดไป <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="page-size">
                    <label>แสดง:</label>
                    <select id="page-size">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                    <span>รายการต่อหน้า</span>
                </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard-tab" class="tab-content">
            <div class="dashboard-container">
                <!-- Dashboard Header -->
                <div class="dashboard-header">
                    <div class="dashboard-title">
                        <h2><i class="fas fa-chart-pie"></i> Resource Analytics Dashboard</h2>
                        <p class="dashboard-subtitle">Real-time insights and analytics for your Azure resources</p>
                    </div>
                    <div class="dashboard-controls">
                        <button id="refresh-dashboard" class="btn btn-secondary">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                        <button id="export-dashboard" class="btn btn-secondary">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button id="dashboard-settings" class="btn btn-secondary">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        <button id="debug-resources" class="btn btn-secondary">
                            <i class="fas fa-bug"></i> Debug
                        </button>
                    </div>
                </div>

                <!-- Dashboard Filters -->
                <div class="dashboard-filters">
                    <div class="filter-group">
                        <label>Time Range:</label>
                        <select id="dashboard-timerange" class="form-control">
                            <option value="all">All Time</option>
                            <option value="30d">Last 30 Days</option>
                            <option value="7d">Last 7 Days</option>
                            <option value="24h">Last 24 Hours</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Subscription:</label>
                        <select id="dashboard-subscription" class="form-control">
                            <option value="">All Subscriptions</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Resource Group:</label>
                        <select id="dashboard-resource-group" class="form-control">
                            <option value="">All Resource Groups</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Location:</label>
                        <select id="dashboard-location" class="form-control">
                            <option value="">All Locations</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Environment:</label>
                        <select id="dashboard-environment" class="form-control">
                            <option value="">All Environments</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="dashboard-search" class="form-control" placeholder="Search resources...">
                    </div>
                    <button id="apply-dashboard-filters" class="btn btn-primary">
                        <i class="fas fa-filter"></i> Apply Filters
                    </button>
                    <button id="clear-dashboard-filters" class="btn btn-secondary">
                        <i class="fas fa-times"></i> Clear All
                    </button>
                </div>
                
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-cube"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-resources">0</h3>
                            <p>Total Resources</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-types">0</h3>
                            <p>Resource Types</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-locations">0</h3>
                            <p>Locations</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                        <div class="stat-content">
                            <h3 id="total-subscriptions">0</h3>
                            <p>Subscriptions</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="dashboard-grid" id="dashboard-grid">
                    <!-- Widget 1: Resource Types Distribution -->
                    <div class="widget-container" data-widget="resource-types">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-chart-pie"></i>
                                <span>Resource Types Distribution</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <canvas id="resource-types-chart"></canvas>
                        </div>
                    </div>

                    <!-- Widget 2: Top Resource Types -->
                    <div class="widget-container" data-widget="top-types">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-list-ol"></i>
                                <span>Top Resource Types</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div id="top-types-list" class="top-list">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Widget 3: Resources by Location -->
                    <div class="widget-container" data-widget="locations">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Resources by Location</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <canvas id="locations-chart"></canvas>
                        </div>
                    </div>

                    <!-- Widget 4: Resources by Environment -->
                    <div class="widget-container" data-widget="environments">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-server"></i>
                                <span>Resources by Environment</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <canvas id="environments-chart"></canvas>
                        </div>
                    </div>

                    <!-- Widget 5: Cost Analysis (New) -->
                    <div class="widget-container" data-widget="cost-analysis">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-dollar-sign"></i>
                                <span>Cost Analysis</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="cost-summary">
                                <div class="cost-item">
                                    <span class="cost-label">Estimated Monthly Cost</span>
                                    <span class="cost-value" id="monthly-cost">$0.00</span>
                                </div>
                                <div class="cost-item">
                                    <span class="cost-label">Top Cost Driver</span>
                                    <span class="cost-value" id="top-cost-driver">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Widget 6: Resource Health -->
                    <div class="widget-container" data-widget="resource-health">
                        <div class="widget-header">
                            <div class="widget-title">
                                <i class="fas fa-heartbeat"></i>
                                <span>Resource Health</span>
                            </div>
                            <div class="widget-controls">
                                <button class="widget-btn" data-action="refresh" title="Refresh">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                                <button class="widget-btn" data-action="expand" title="Expand">
                                    <i class="fas fa-expand"></i>
                                </button>
                                <button class="widget-btn" data-action="settings" title="Settings">
                                    <i class="fas fa-cog"></i>
                                </button>
                            </div>
                        </div>
                        <div class="widget-content">
                            <div class="health-indicators">
                                <div class="health-item">
                                    <div class="health-status healthy">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div class="health-info">
                                        <span class="health-count" id="healthy-resources">0</span>
                                        <span class="health-label">Healthy</span>
                                    </div>
                                </div>
                                <div class="health-item">
                                    <div class="health-status warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="health-info">
                                        <span class="health-count" id="warning-resources">0</span>
                                        <span class="health-label">Warning</span>
                                    </div>
                                </div>
                                <div class="health-item">
                                    <div class="health-status critical">
                                        <i class="fas fa-times-circle"></i>
                                    </div>
                                    <div class="health-info">
                                        <span class="health-count" id="critical-resources">0</span>
                                        <span class="health-label">Critical</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Subscriptions Tab -->
        <div id="subscriptions-tab" class="tab-content">
            <div class="action-section">
                <button id="add-subscription-btn" class="btn btn-success">
                    <i class="fas fa-plus"></i> เพิ่ม Subscription
                </button>
            </div>

            <div class="table-container">
                <table id="subscriptions-table" class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Tenant ID</th>
                            <th>Created</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="subscriptions-tbody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal for Add/Edit Resource -->
    <div id="resource-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">เพิ่ม Resource</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="resource-form">
                    <input type="hidden" id="resource-id">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="resource-name">Name *</label>
                            <input type="text" id="resource-name" required>
                        </div>
                        <div class="form-group">
                            <label for="resource-type">Type *</label>
                            <input type="text" id="resource-type" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="resource-kind">Kind</label>
                            <input type="text" id="resource-kind">
                        </div>
                        <div class="form-group">
                            <label for="resource-location">Location *</label>
                            <input type="text" id="resource-location" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="subscription-select">Subscription *</label>
                            <select id="subscription-select" required>
                                <option value="">เลือก Subscription</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="resource-group-id">Resource Group ID</label>
                            <input type="number" id="resource-group-id">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="resource-environment">Environment</label>
                            <input type="text" id="resource-environment">
                        </div>
                        <div class="form-group">
                            <label for="resource-vendor">Vendor</label>
                            <input type="text" id="resource-vendor">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="resource-provisioner">Provisioner</label>
                        <input type="text" id="resource-provisioner">
                    </div>

                    <div class="form-group">
                        <label for="resource-tags">Tags</label>
                        <div id="modal-tags-dropdown-container"></div>
                        <small>เลือก tags ที่ต้องการหรือเพิ่มใหม่</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-btn">ยกเลิก</button>
                <button type="submit" form="resource-form" class="btn btn-primary" id="save-btn">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- Modal for Add/Edit Subscription -->
    <div id="subscription-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="subscription-modal-title">เพิ่ม Subscription</h3>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="subscription-form">
                    <input type="hidden" id="subscription-id">
                    
                    <div class="form-group">
                        <label for="subscription-name">Name *</label>
                        <input type="text" id="subscription-name" required>
                    </div>

                    <div class="form-group">
                        <label for="subscription-tenant-id">Tenant ID</label>
                        <input type="text" id="subscription-tenant-id">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="subscription-cancel-btn">ยกเลิก</button>
                <button type="submit" form="subscription-form" class="btn btn-primary" id="subscription-save-btn">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="loading" style="display: none;">
        <div class="spinner"></div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script src="/js/api-client.js?v=1.0.0"></script>
    <script src="/js/searchable-dropdown.js?v=1.0.0"></script>
    <script src="/js/tags-component.js?v=1.0.0"></script>
    <script src="/js/connection-test.js?v=1.0.0"></script>
    <script src="/js/app.js?v=1.0.0"></script>
</body>
</html>
